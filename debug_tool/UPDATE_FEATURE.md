# 自动更新功能说明

## 功能概述

为 qt_app.py 添加了自动检查和更新功能，可以从 GitHub Release 页面自动检查最新版本并下载更新。

## 主要特性

### 1. 自动版本检查
- 应用启动后 3 秒自动检查更新
- 检查 GitHub API: `https://api.github.com/repos/liu994505261/Multifun_debug_tool/releases/latest`
- 比较当前版本与最新版本

### 2. 用户交互
- 发现新版本时弹出对话框询问用户
- 提供三个选项：
  - **是**: 立即下载并安装更新
  - **否**: 忽略此次更新
  - **稍后提醒**: 30分钟后再次检查

### 3. 后台下载
- 显示下载进度对话框
- 支持进度条显示下载百分比
- 下载到系统临时目录 `temp/multifun_debug_tool_update/`

### 4. 自动安装
- 下载完成后自动安装
- 支持 `.exe` 和 `.zip` 格式
- 自动备份当前版本（`.backup` 后缀）
- 安装完成后提示重启应用

### 5. 手动检查
- 帮助菜单中添加"检查更新"选项
- 用户可随时手动检查更新

## 文件结构

```
debug_tool/
├── app/
│   └── version_manager.py      # 版本管理核心模块
├── qt_app.py                   # 主应用（已集成更新功能）
├── version.json                # 版本配置文件
├── requirements.txt            # 依赖（已添加 requests）
└── test_version_check.py       # 测试脚本
```

## 版本配置

版本信息存储在 `version.json` 文件中：

```json
{
  "version": "1.0.0",
  "build_date": "2024-12-10",
  "description": "通信测试上位机 - 多功能调试工具"
}
```

## 使用方法

### 开发环境测试
```bash
cd debug_tool
python test_version_check.py
```

### 正常使用
1. 启动应用程序
2. 应用会自动检查更新
3. 如有新版本，按提示操作即可

### 手动检查更新
- 菜单栏 → 帮助 → 检查更新

## 技术实现

### 版本比较
- 使用语义化版本号比较 (如 1.0.0 vs 1.0.1)
- 支持 `v` 前缀的标签格式

### 下载逻辑
- 自动识别 Windows 可执行文件 (`.exe` 或 `.zip`)
- 流式下载，支持大文件
- 实时进度反馈

### 安全措施
- 下载前备份当前版本
- 安装失败时可恢复备份
- 所有操作在后台线程执行，不阻塞 UI

## 依赖要求

新增依赖：
- `requests>=2.25.0` - HTTP 请求库

## 注意事项

1. **网络连接**: 需要能访问 GitHub API 和 Release 页面
2. **文件权限**: 需要对应用程序目录有写权限
3. **防火墙**: 确保网络请求不被阻止
4. **Release 格式**: GitHub Release 需要包含 Windows 可执行文件

## 错误处理

- 网络连接失败：静默忽略，不影响应用正常使用
- 下载失败：显示错误信息，用户可稍后重试
- 安装失败：显示错误信息，保留备份文件

## 自定义配置

可以通过修改 `VersionManager` 构造参数来自定义：
- 仓库 URL
- 检查间隔
- 临时目录位置